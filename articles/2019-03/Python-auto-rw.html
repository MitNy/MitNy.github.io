<!DOCTYPE html><html><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-W055DP4N3J"></script><script>
					window.dataLayer = window.dataLayer || [];
					function gtag(){dataLayer.push(arguments);}
					gtag('js', new Date());
					gtag('config', 'G-W055DP4N3J');</script><head><meta charSet="utf-8"/><meta name="description" content="기록 저장소"/><meta property="og:description" content="기록 저장소"/><meta property="og:url" content="https://mitny.github.io"/><meta property="og:type" content="website"/><meta property="og:locale" content="ko_KR"/><meta property="og:site_name" content="MitNy.log"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><title>[Python] 엑셀 데이터 파싱 후 MySQL Insert 하기 |  MitNy.log</title><meta name="robots" content="index,follow"/><meta property="og:title" content="[Python] 엑셀 데이터 파싱 후 MySQL Insert 하기 |  MitNy.log"/><link rel="canonical" href="https://mitny.github.io/articles/2019-03-14-Python-auto-rw"/><meta name="next-head-count" content="12"/><meta name="naver-site-verification" content="b408dee953bcbbb1038384f191f36dac0551c0fb"/><meta name="google-site-verification" content="vUtYhRYNCWYYTdurCRaVmtnWpPLuXKKwRAm5F6R9sNs"/><link rel="preload" href="/_next/static/css/e6a7c67d207b98b3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e6a7c67d207b98b3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-005bdf76005efab4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-14a2a9a26060c1d3.js" defer=""></script><script src="/_next/static/chunks/401-9f1400d964d6d7ce.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bdir_slug%5D/%5Bslug%5D-0b7b92862b8a360a.js" defer=""></script><script src="/_next/static/nJPyYqODS0udXw2rMLLyn/_buildManifest.js" defer=""></script><script src="/_next/static/nJPyYqODS0udXw2rMLLyn/_ssgManifest.js" defer=""></script></head><link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/manifest.json"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png"/><meta name="theme-color" content="#ffffff"/><body><div id="__next" data-reactroot=""><div class="header h-16 bg-white drop-shadow-md text-black"><div class="mx-10 pt-3 cursor-pointer"><p class="header-home text-3xl float-left">MitNy.log</p><p class="text-base font-bold pt-2 float-right">About</p></div></div><div class="mx-10 my-8"><div class="w-full min-h-screen pb-24 mt-8"><div class="w-full min-h-screen pb-24 mt-8"><article class="prose max-w-none"><div class="border-b"><p class="text-4xl font-bold mb-0">[Python] 엑셀 데이터 파싱 후 MySQL Insert 하기</p><p class="text-xs text-neutral-500"></p></div><div><p>지금까지 동아리 페이지 관리에 필요한 데이터들을 직접 Insert 쿼리를 넘겨 저장해왔는데,
후배들을 위해 자동화 프로그램을 만들게 되었다.</p>
<p><img src="/assets/posts/python/excel_table.png" alt=""></p>
<p>이런 형식을 가진 엑셀 파일이 매 학기마다 만들어진다.
이 데이터 중 테이블에 필요한 학번, 이름 정보만 파싱해 저장할 것이다.
저장된 데이터는 MySQL connector를 통해 특정 테이블에 Insert 한다.</p>
<pre class="language-py"><code class="language-py code-highlight"><span class="code-line"><span class="token comment"># -*- coding: utf-8 -*-</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> openpyxl
</span><span class="code-line"><span class="token keyword">import</span> mysql<span class="token punctuation">.</span>connector
</span><span class="code-line"><span class="token keyword">import</span> os
</span><span class="code-line"><span class="token keyword">import</span> sys
</span><span class="code-line">
</span><span class="code-line">result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 엑셀 데이터를 tuple 형식으로 저장 학번이 201600000 일 경우 16만 저장하도록 파싱 </span>
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">excel_to_list</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">	wb <span class="token operator">=</span> openpyxl<span class="token punctuation">.</span>load_workbook<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
</span><span class="code-line">	ws <span class="token operator">=</span> wb<span class="token punctuation">.</span>active
</span><span class="code-line">	tmp_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line">	<span class="token keyword">for</span> r <span class="token keyword">in</span> ws<span class="token punctuation">.</span>rows<span class="token punctuation">:</span>
</span><span class="code-line">		name <span class="token operator">=</span> r<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value
</span><span class="code-line">		stuNum <span class="token operator">=</span> r<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value
</span><span class="code-line">
</span><span class="code-line">		<span class="token keyword">if</span> name <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> <span class="token builtin">str</span><span class="token punctuation">(</span>stuNum<span class="token punctuation">)</span><span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">			tmp_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>stuNum<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">			tmp_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>tmp_data<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
</span><span class="code-line">			result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">tuple</span><span class="token punctuation">(</span>tmp_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">			tmp_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># mysql 테이블에 튜플 데이터 삽입</span>
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">mysql_insert</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span>table<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">	<span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line">		cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">		sql <span class="token operator">=</span> <span class="token string">"INSERT INTO "</span><span class="token operator">+</span>table<span class="token operator">+</span><span class="token string">" (stuNum,name) VALUES (%s, %s)"</span>
</span><span class="code-line">		cursor<span class="token punctuation">.</span>executemany<span class="token punctuation">(</span>sql<span class="token punctuation">,</span>data<span class="token punctuation">)</span>
</span><span class="code-line">		db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] Insertion success\n"</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">except</span><span class="token punctuation">:</span>
</span><span class="code-line">		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[ERROR] Insertion failed\n"</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># mysql 테이블의 기존 데이터를 삭제</span>
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">table_clear</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span>table<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">	<span class="token keyword">try</span><span class="token punctuation">:</span>
</span><span class="code-line">		cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">		cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"TRUNCATE TABLE "</span><span class="token operator">+</span>table<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">except</span><span class="token punctuation">:</span>
</span><span class="code-line">		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[ERROR] Truncate failed\n"</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># 파일이 존재하는지 체크</span>
</span><span class="code-line"><span class="token comment"># return : True or False</span>
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">fileCheck</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">	<span class="token keyword">return</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span><span class="token string">"./"</span><span class="token operator">+</span>filename<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">	db <span class="token operator">=</span> mysql<span class="token punctuation">.</span>connector<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
</span><span class="code-line">		host<span class="token operator">=</span><span class="token string">"localhost"</span><span class="token punctuation">,</span>
</span><span class="code-line">		user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>
</span><span class="code-line">		passwd<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span>
</span><span class="code-line">		database<span class="token operator">=</span><span class="token string">""</span>
</span><span class="code-line">	<span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"* * * * * * 세미나 랜덤지목 데이터 삽입 자동화 프로그램* * * * * *"</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] exit 입력 시 종료됩니다."</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 엑셀 파일은 .py 파일과 같은 디렉토리에 존재해야 합니다."</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] 테이블이 존재하지 않을 경우 생성 후 가능합니다.\n"</span><span class="token punctuation">)</span>
</span><span class="code-line">	<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
</span><span class="code-line">		filename <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"1. 엑셀 파일명 입력 : "</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">if</span> fileCheck<span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
</span><span class="code-line">			table <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"3. 데이터베이스 테이블명 입력 : "</span><span class="token punctuation">)</span>
</span><span class="code-line">			excel_to_list<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
</span><span class="code-line">			answer <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"[*] 테이블 내 기존 데이터가 삭제됩니다. 진행하시겠습니까? (Y,n) : "</span><span class="token punctuation">)</span>
</span><span class="code-line">			<span class="token keyword">if</span> answer <span class="token operator">==</span> <span class="token string">"Y"</span><span class="token punctuation">:</span>
</span><span class="code-line">				table_clear<span class="token punctuation">(</span>db<span class="token punctuation">,</span>table<span class="token punctuation">)</span>
</span><span class="code-line">				mysql_insert<span class="token punctuation">(</span>db<span class="token punctuation">,</span>table<span class="token punctuation">,</span>result<span class="token punctuation">)</span>
</span><span class="code-line">				<span class="token keyword">break</span>
</span><span class="code-line">			<span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">				<span class="token keyword">continue</span>
</span><span class="code-line">		<span class="token keyword">elif</span> filename <span class="token operator">==</span> <span class="token string">"exit"</span><span class="token punctuation">:</span>
</span><span class="code-line">			db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">			sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">		<span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">			<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[ERROR] 파일이 존재하지 않습니다."</span><span class="token punctuation">)</span>
</span><span class="code-line">			<span class="token keyword">continue</span>
</span><span class="code-line">		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">	sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
</span><span class="code-line">    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre>
<ol>
<li>.py 파일과 엑셀 파일을 같은 경로에 놓는다.</li>
<li>엑셀 파일명을 입력한다.</li>
<li>엑셀 데이터를 넣을 테이블명을 입력한다.</li>
<li>Y를 입력하면 MySQL truncate, insert 명령 실행</li>
</ol></div></article></div></div></div><footer class="h-16 bg-neutral-500"></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"2019-03-14-Python-auto-rw","content":"\n지금까지 동아리 페이지 관리에 필요한 데이터들을 직접 Insert 쿼리를 넘겨 저장해왔는데,\n후배들을 위해 자동화 프로그램을 만들게 되었다.\n\n![](/assets/posts/python/excel_table.png)\n\n이런 형식을 가진 엑셀 파일이 매 학기마다 만들어진다.\n이 데이터 중 테이블에 필요한 학번, 이름 정보만 파싱해 저장할 것이다.\n저장된 데이터는 MySQL connector를 통해 특정 테이블에 Insert 한다.\n\n```py\n# -*- coding: utf-8 -*-\n\nimport openpyxl\nimport mysql.connector\nimport os\nimport sys\n\nresult = []\n\n# 엑셀 데이터를 tuple 형식으로 저장 학번이 201600000 일 경우 16만 저장하도록 파싱 \ndef excel_to_list(filename):\n\twb = openpyxl.load_workbook(filename)\n\tws = wb.active\n\ttmp_data = []\n\tfor r in ws.rows:\n\t\tname = r[1].value\n\t\tstuNum = r[2].value\n\n\t\tif name is not None and str(stuNum).isdigit():\n\t\t\ttmp_data.append(str(stuNum)[2:4])\n\t\t\ttmp_data.append(name)\n\t\tif len(tmp_data) == 2:\n\t\t\tresult.append(tuple(tmp_data))\n\t\t\ttmp_data = []\n\n# mysql 테이블에 튜플 데이터 삽입\ndef mysql_insert(db,table,data):\n\ttry:\n\t\tcursor = db.cursor()\n\t\tsql = \"INSERT INTO \"+table+\" (stuNum,name) VALUES (%s, %s)\"\n\t\tcursor.executemany(sql,data)\n\t\tdb.commit()\n\t\tprint(\"[+] Insertion success\\n\")\n\texcept:\n\t\tprint(\"[ERROR] Insertion failed\\n\")\n\n# mysql 테이블의 기존 데이터를 삭제\ndef table_clear(db,table):\n\ttry:\n\t\tcursor = db.cursor()\n\t\tcursor.execute(\"TRUNCATE TABLE \"+table)\n\texcept:\n\t\tprint(\"[ERROR] Truncate failed\\n\")\n\n# 파일이 존재하는지 체크\n# return : True or False\ndef fileCheck(filename):\n\treturn os.path.isfile(\"./\"+filename)\n\ndef main():\n\tdb = mysql.connector.connect(\n\t\thost=\"localhost\",\n\t\tuser=\"root\",\n\t\tpasswd=\"\",\n\t\tdatabase=\"\"\n\t)\n\tprint(\"* * * * * * 세미나 랜덤지목 데이터 삽입 자동화 프로그램* * * * * *\")\n\tprint(\"[*] exit 입력 시 종료됩니다.\")\n\tprint(\"[*] 엑셀 파일은 .py 파일과 같은 디렉토리에 존재해야 합니다.\")\n\tprint(\"[*] 테이블이 존재하지 않을 경우 생성 후 가능합니다.\\n\")\n\twhile True:\n\t\tfilename = input(\"1. 엑셀 파일명 입력 : \")\n\t\tif fileCheck(filename) is True:\n\t\t\ttable = input(\"3. 데이터베이스 테이블명 입력 : \")\n\t\t\texcel_to_list(filename)\n\t\t\tanswer = input(\"[*] 테이블 내 기존 데이터가 삭제됩니다. 진행하시겠습니까? (Y,n) : \")\n\t\t\tif answer == \"Y\":\n\t\t\t\ttable_clear(db,table)\n\t\t\t\tmysql_insert(db,table,result)\n\t\t\t\tbreak\n\t\t\telse:\n\t\t\t\tcontinue\n\t\telif filename == \"exit\":\n\t\t\tdb.close()\n\t\t\tsys.exit(1)\n\t\telse:\n\t\t\tprint(\"[ERROR] 파일이 존재하지 않습니다.\")\n\t\t\tcontinue\n\t\tprint(\"\\n\")\n\n\tsys.exit(1)\n\nif __name__ == \"__main__\":\n    main()\n```\n\n1. .py 파일과 엑셀 파일을 같은 경로에 놓는다.\n2. 엑셀 파일명을 입력한다.\n3. 엑셀 데이터를 넣을 테이블명을 입력한다.\n4. Y를 입력하면 MySQL truncate, insert 명령 실행\n\n\n","layout":"post","title":"[Python] 엑셀 데이터 파싱 후 MySQL Insert 하기","categories":["Python"],"excerpt":" ","comments":true,"share":true,"tags":["Python","Excel","MySQL"]}},"__N_SSG":true},"page":"/articles/[dir_slug]/[slug]","query":{"dir_slug":"2019-03","slug":"Python-auto-rw"},"buildId":"nJPyYqODS0udXw2rMLLyn","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>