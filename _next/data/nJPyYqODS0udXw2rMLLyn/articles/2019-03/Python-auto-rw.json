{"pageProps":{"post":{"slug":"2019-03-14-Python-auto-rw","content":"\n지금까지 동아리 페이지 관리에 필요한 데이터들을 직접 Insert 쿼리를 넘겨 저장해왔는데,\n후배들을 위해 자동화 프로그램을 만들게 되었다.\n\n![](/assets/posts/python/excel_table.png)\n\n이런 형식을 가진 엑셀 파일이 매 학기마다 만들어진다.\n이 데이터 중 테이블에 필요한 학번, 이름 정보만 파싱해 저장할 것이다.\n저장된 데이터는 MySQL connector를 통해 특정 테이블에 Insert 한다.\n\n```py\n# -*- coding: utf-8 -*-\n\nimport openpyxl\nimport mysql.connector\nimport os\nimport sys\n\nresult = []\n\n# 엑셀 데이터를 tuple 형식으로 저장 학번이 201600000 일 경우 16만 저장하도록 파싱 \ndef excel_to_list(filename):\n\twb = openpyxl.load_workbook(filename)\n\tws = wb.active\n\ttmp_data = []\n\tfor r in ws.rows:\n\t\tname = r[1].value\n\t\tstuNum = r[2].value\n\n\t\tif name is not None and str(stuNum).isdigit():\n\t\t\ttmp_data.append(str(stuNum)[2:4])\n\t\t\ttmp_data.append(name)\n\t\tif len(tmp_data) == 2:\n\t\t\tresult.append(tuple(tmp_data))\n\t\t\ttmp_data = []\n\n# mysql 테이블에 튜플 데이터 삽입\ndef mysql_insert(db,table,data):\n\ttry:\n\t\tcursor = db.cursor()\n\t\tsql = \"INSERT INTO \"+table+\" (stuNum,name) VALUES (%s, %s)\"\n\t\tcursor.executemany(sql,data)\n\t\tdb.commit()\n\t\tprint(\"[+] Insertion success\\n\")\n\texcept:\n\t\tprint(\"[ERROR] Insertion failed\\n\")\n\n# mysql 테이블의 기존 데이터를 삭제\ndef table_clear(db,table):\n\ttry:\n\t\tcursor = db.cursor()\n\t\tcursor.execute(\"TRUNCATE TABLE \"+table)\n\texcept:\n\t\tprint(\"[ERROR] Truncate failed\\n\")\n\n# 파일이 존재하는지 체크\n# return : True or False\ndef fileCheck(filename):\n\treturn os.path.isfile(\"./\"+filename)\n\ndef main():\n\tdb = mysql.connector.connect(\n\t\thost=\"localhost\",\n\t\tuser=\"root\",\n\t\tpasswd=\"\",\n\t\tdatabase=\"\"\n\t)\n\tprint(\"* * * * * * 세미나 랜덤지목 데이터 삽입 자동화 프로그램* * * * * *\")\n\tprint(\"[*] exit 입력 시 종료됩니다.\")\n\tprint(\"[*] 엑셀 파일은 .py 파일과 같은 디렉토리에 존재해야 합니다.\")\n\tprint(\"[*] 테이블이 존재하지 않을 경우 생성 후 가능합니다.\\n\")\n\twhile True:\n\t\tfilename = input(\"1. 엑셀 파일명 입력 : \")\n\t\tif fileCheck(filename) is True:\n\t\t\ttable = input(\"3. 데이터베이스 테이블명 입력 : \")\n\t\t\texcel_to_list(filename)\n\t\t\tanswer = input(\"[*] 테이블 내 기존 데이터가 삭제됩니다. 진행하시겠습니까? (Y,n) : \")\n\t\t\tif answer == \"Y\":\n\t\t\t\ttable_clear(db,table)\n\t\t\t\tmysql_insert(db,table,result)\n\t\t\t\tbreak\n\t\t\telse:\n\t\t\t\tcontinue\n\t\telif filename == \"exit\":\n\t\t\tdb.close()\n\t\t\tsys.exit(1)\n\t\telse:\n\t\t\tprint(\"[ERROR] 파일이 존재하지 않습니다.\")\n\t\t\tcontinue\n\t\tprint(\"\\n\")\n\n\tsys.exit(1)\n\nif __name__ == \"__main__\":\n    main()\n```\n\n1. .py 파일과 엑셀 파일을 같은 경로에 놓는다.\n2. 엑셀 파일명을 입력한다.\n3. 엑셀 데이터를 넣을 테이블명을 입력한다.\n4. Y를 입력하면 MySQL truncate, insert 명령 실행\n\n\n","layout":"post","title":"[Python] 엑셀 데이터 파싱 후 MySQL Insert 하기","categories":["Python"],"excerpt":" ","comments":true,"share":true,"tags":["Python","Excel","MySQL"]}},"__N_SSG":true}