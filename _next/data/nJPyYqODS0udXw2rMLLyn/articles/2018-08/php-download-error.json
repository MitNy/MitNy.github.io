{"pageProps":{"post":{"slug":"2018-08-06-php-download-error","content":"\n### 환경: Ubuntu 18.04 LTS / apache2 / php7.0\n\n웹 서버 세팅을 위해 php모듈 포함 apm을 정상적으로 설치했는데,\n처음엔 아래 명령어를 입력하지 않아서 user 접속시 404 not found만 떴었다.\n그 에러는 아래 명령어로 해결\n```\nsudo a2enmod userdir\nsudo service apache2 restart\n```\n404 not found는 해결했으나\n`ip/~user/test.php` 등으로 php 파일에 접근하면 파일 내용이 보이는 것이 아니라 다운로드 되는 현상이 지속되었다.\n이 에러 해결을 위해 아예 서버를 갈아엎고 온갖 삽질을 다 했는데 해결이 안됐었다.\n해결 방법을 찾아봐도 php.ini 에서 `short_open_tag = On` 로 default값인 Off를 On으로 바꾸라는 것이 제일 많았다.\n하지만 php를 항상 `<?php ?>`로 사용해왔기 때문에 효과적인 해결 방법은 아니었다.\n\napache2.conf도 고쳐보고 php.ini도 고쳐보고 하다가 진짜 해결 방법을 찾았다.\n\n1. /etc/apache2/apache2.conf 수정\n![](/assets/posts/php/apache2conf_edit.png)\n\n모든 유저에 대한 public_html 디렉토리 설정을 해준다.\n\n```php\n<Directory /home/*/public_html/>\n        Options FollowSymLinks MultiViews\n        AddType application/x-httpd-php .php .jsp\n        AllowOverride FileInfo\n        Require all granted\n</Directory>\n```\n\nAddType 부분은 원하는대로 설정을 바꿔주면 된다.\n\n2. /etc/apache/mods-enabled/php7.2.conf\n* php는 버전에 따라 파일명 변경\n\n```php\n<IfModule mod_userdir.c>\n    <Directory /home/*/public_html>\n        php_admin_flag engine On\n    </Directory>\n</IfModule>\n```\n\n3. /etc/apache2/sites-enabled/000-default.conf 수정\nVirtualHost 바깥에 추가\n\n```php\nAlias /public_html /home/*/public_html\n<Directory /home/*/public_html>\n    Options FollowSymLinks\n    #DirectoryIndex index.php\n    AllowOverride All\n</Directory>\n```\n\n설정을 바꿔준 후에는 꼭 아파치를 재시작 해준다.\n`service apache2 restart`\n\n이렇게 설정해줬더니 php 파일이 다운로드 되는 것이 아닌 정상출력 되었다.\n","layout":"post","title":"[PHP] php 파일 접근시 다운로드 에러","categories":["PHP"],"excerpt":" ","comments":true,"share":true,"tags":["php","Ubuntu","download"]}},"__N_SSG":true}