{"pageProps":{"post":{"slug":"2019-01-24-LetsEncrypt","content":"\n지난번에 OpenSSL을 통해 https로 접속을 할 수 있도록 설정한 사이트가 있었는데\n'연결이 비공개로 설정되어 있지 않습니다.' 라는 메시지를 보고 싶지 않아서\n`Let's Encrypt`를 사용하려고 한다.\n\n\n### Let's Encrypt 설치하기\n1. apt-get install letsencrypt\n![](/assets/posts/ubuntu/letsencryptInstall.png)\n\n### 인증서 발급 받기\n1. letsencrypt certonly --webroot --webroot-path=/var/www/html -d domain.com\n- d 옵션으로 인증할 도메인의 주소를 설정할 수 있다. `-d domain -d domain` 처럼 다수의 도메인도 한 번에 설정할 수 있다.\n- webroot-path에는 웹 서버의 기본 경로로 설정해주었다.\n\n위 명령을 실행하면 다음과 같이 인증 만료 알림이나 키 복구를 위한 이메일을 입력하는 창이 뜬다.\n![](/assets/posts/ubuntu/letsEmail.png)\n\n이메일 입력 후 동의하면 완료된다.\n![](/assets/posts/ubuntu/letsAgree.png)\n\n\n인증서 발급이 성공적으로 끝나면 다음 메시지가 뜬다.\n![](/assets/posts/ubuntu/letsNote.png)\n\n인증서의 위치는 `/etc/letsencrypt/live/[domain]/` 위치에 있다\n- cert.pem : 인증서 파일\n- chain.pem : 인증서 발급자 파일\n- fullchain.pem : cert.pem+chain.pem\n- privkey.pem : 인증암호를 복호화하는 개인키\n\n![](/assets/posts/ubuntu/letsDir.png)\n\n### 인증서 설정하기\n1. /etc/apache2/sites-abailable/default-ssl.conf 파일 복사\n- default-ssl.conf 파일을 [domain].conf 나 아무 파일명을 써서 복사한다.\n- 이 글에선 back-ssl.conf를 사용합니다.\n`sudo cp /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-available/back-ssl.conf`\n\n2. 복사한 conf 파일 수정(back-ssl.conf 수정)\n\n- SSLEngine on\n- SSLProtocol all -SSLv2 -SSLv3\n- SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA\n \n- SSLHonorCipherOrder on\n \n- SSLCertificateFile \"/etc/letsencrypt/live/[폴더명]/cert.pem\"\n- SSLCertificateKeyFile \"/etc/letsencrypt/live/[폴더명]/privkey.pem\"\n- SSLCertificateChainFile \"/etc/letsencrypt/live/[폴더명]/chain.pem\"\n- SSLOptions +FakeBasicAuth +ExportCertData +StrictRequire 주석 해제\n\n![](/assets/posts/ubuntu/letsSSL.png)\n![](/assets/posts/ubuntu/letsConfig.png)\n\n3. SSL 모듈 활성화\n`sudo a2enmod ssl`\n\n4. back-ssl 활성화\n`sudo a2ensite back-ssl`\n\n5. 443 포트 접속 허용하기\n`sudo ufw allow 443/tcp`\n\n6. apache 재시작\n`sudo service apache2 restart`\n\n### 사이트 접속 확인\n크롬 주소창에 '주의 요함','이 사이트는 보안 연결(HTTPS)이 사용되지 않았습니다.' 같은 메시지가 더 이상 뜨지 않는다.\n![](/assets/posts/ubuntu/letsPage.png)\n\n다음은 http -> https 리다이렉션을 할 생각이다.\n","layout":"post","title":"[Ubuntu] Ubuntu 16.04 Let's Encrypt로 https 설정하기","categories":["Ubuntu"],"excerpt":" ","comments":true,"share":true,"tags":["Ubuntu","SSL","HTTPS"]}},"__N_SSG":true}