{"pageProps":{"post":{"slug":"2019-04-15-MySQL-to-Googlespreadsheet","content":"\nMySQL 테이블 데이터를 구글 스프레드 시트로 만들어야 하는데 일일이 하긴 번거로워서<br>\n구글 스프레드의 스크립트 기능을 이용해 커넥션을 생성, 데이터를 불러오는 코드를 짰다.<br>\n이렇게 귀찮음을 코드로 푸는 나를 보면서 정말 컴공스럽다라는 생각이 든다....<br>\n\n보안상의 이유로 실제 테이블 대신 블로그용 테스트 테이블을 사용했다. 테이블 구조는 다음과 같다.\n![](/assets/posts/mysql/eduboard.png)\n\n우선 외부에서 데이터베이스에 접속할 수 있도록 설정을 해주어야 한다.\n그 부분은 [이곳에서](https://idchowto.com/?p=11068)\n\n설정이 끝나면 구글 스프레드 시트를 하나 만들고 `도구 > 스크립트 편집기`에 들어간다.\n![](/assets/posts/mysql/sheet_tools.png)\n\n```javascript\n<script src=\"https://gist.github.com/e6129c9fd9bc74e814d0?file-pull-and-sync-data-between-google-doc-spreadsheet-and-mysql-gs\" type=\"text/javascript\"/>\nvar connectionName = 'IP:MySQL Port'; // 접속할 MySQL 서버의 IP와 Port(Default:3306)\nvar user = ''; // MySQL 유저 ID\nvar userPwd = ''; // MySQL 유저 PW\nvar db = ''; // 접속할 MySQL DB명\nvar instanceUrl = 'jdbc:mysql://' + connectionName;\nvar dbUrl = instanceUrl + '/' + db;\nvar sheet = SpreadsheetApp.getActiveSheet(); // SpreadSheet 객체 생성\n\nfunction exportDatabase() {\n  var conn = Jdbc.getConnection(dbUrl, user, userPwd); // DB 연결\n  var stmt = conn.createStatement();\n  stmt.setMaxRows(1000);\n  var results = stmt.executeQuery(\"SELECT title,content,author,date from eduboard\"); // 쿼리\n  var i=2; // 2번째 row부터 채움\n  while(results.next()) {\n\t  // getRange(Integer row, Integer Column)\n      title = sheet.getRange(i, 1); // A2\n      content = sheet.getRange(i, 2); // B2\n      author = sheet.getRange(i, 3); // C2\n      date = sheet.getRange(i, 4); // D2\n      title.setValue(results.getString(\"title\")); // 현재 row의 title 컬럼 값\n      content.setValue(results.getString(\"content\")); // 현재 row의 content 컬럼 값\n      author.setValue(results.getString(\"author\")); // 현재 row의 author 컬럼 값\n      date.setValue(results.getString(\"date\")); // 현재 row의 date 컬럼 값\n      i++;\n  }\n  \n  /* 연결 해제 */\n  results.close();\n  stmt.close();\n  conn.close();\n}\n```\n\n### 시트별 삽입\n![](/assets/posts/mysql/yearlySheet.png)\n시트가 이런식으로 나누어져있을 경우, 각 시트별로 데이터를 넣고싶다면 위 코드와 조금 다르게 해야한다.\n```javascript\nvar sheet = SpreadsheetApp.getActiveSpreadsheet();\nvar activeSheet = '';\n\nfunction database_2019() {\n  activeSheet = \"2019\"; // 시트명 변경\n  SpreadsheetApp.setActiveSheet(sheet.getSheetByName(activeSheet));\n  var conn = Jdbc.getConnection(dbUrl, user, userPwd); // DB 연결\n  var stmt = conn.createStatement();\n  stmt.setMaxRows(1000);\n  var results = stmt.executeQuery(\"SELECT stuID,name,seminarTheme,seminarDate FROM seminar_list WHERE seminarDate BETWEEN '2019-01-01' AND '2019-12-31' ORDER BY seminarDate DESC\"); // 특정 기간 내 데이터만 불러오는 쿼리\n  var i=2;\n  while(results.next()) {\n    sID = sheet.getRange(activeSheet+\"!A\"+i); // \"시트명!A2\" 특정 시트의 A2 위치에 삽입\n    sName = sheet.getRange(activeSheet+\"!B\"+i); // EX) test!A2:B2 일 경우 A2부터 B2까지 사각형 모양으로 채움\n    sTheme = sheet.getRange(activeSheet+\"!C\"+i);\n    sDate = sheet.getRange(activeSheet+\"!D\"+i);\n    sID.setValue(results.getString(\"stuID\"));\n    sName.setValue(results.getString(\"name\"));\n    sTheme.setValue(results.getString(\"seminarTheme\"));\n    sDate.setValue(results.getString(\"seminarDate\"));\n    i++;\n  }\n  results.close();\n  stmt.close();\n  conn.close();\n}\n\n```\n\n\n\n1. 참고사이트1: [Google Apps srcipt jdbc guide](https://developers.google.com/apps-script/guides/jdbc)<br>\n2. 참고사이트2: [Blog](https://medium.com/@pradeepbheron/pull-and-sync-data-between-google-doc-spreadsheet-and-mysql-1d5a09d787a4)<br>\n\n위 코드는 ▶ 버튼을 눌러 실행시킬 수 있다.\n![](/assets/posts/mysql/gs_script.png)\n\n처음 실행시키면 권한 인증창이 뜨고 계정 선택 및 허용 등의 과정을 거치면 된다.\n![](/assets/posts/mysql/run_popup.png)\n\n실행 결과는 스프레드 시트에 바로 업데이트 된다.\n![](/assets/posts/mysql/select_result.png)\n\n실행 로그는 `보기>실행` 에서 확인해볼 수 있고, 실패 원인 분석 등에 쓰인다.\n![](/assets/posts/mysql/run_log.png)\n","layout":"post","title":"[MySQL] MySQL 데이터를 구글 스프레드 시트로 불러오기","categories":["MySQL"],"excerpt":" ","comments":true,"share":true,"tags":["MySQL","Google"]}},"__N_SSG":true}